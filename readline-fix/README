Created on: Wed 28 Apr 2010 01:43:15 PM 
Last saved: Wed 28 Apr 2010 10:05:33 PM

README for Term::ReadLine::Gnu port to win32

Current directory contents:
  Gnu.xs       - modified XS file
  Makefile     - modified post-Makefile.PL to change libreadline.a to libreadline.dll.a
  Makefile.PL  - modified to skip exit for missing termcap, ncurses or curses
  README       - this file


To get a full featured shell working on a win32 system,
we need to have working Term::ReadLine::Gnu support.
I downloaded the pre-built win32 readline library from

  http://gnuwin32.sourceforge.net/packages/readline.htm

and am working through the build failures for
Term-ReadLine-Gnu-1.19.tar.gz on win32 using mingw gcc
version 3.4.5.

Problem 1: The perl Makefile.PL step exited because
there was no termcap/ncurses/curses library.  I commented
out that line because I found no include in the source
for any of those libraries.

Problem 2: The test link of a sample readline using
function failed because the includes/libraries are not
in the paths.  I added --prefix to the Makefile.PL and
now the library is found and the test works.  There are
other options that may be needed for non-default file
locations.

Problem 3: The Gnu.xs failed to compile because the
declarations for str_tbl[], int_tbl[], and fn_tbl[]
all used {} static initialization.  This only works
if the values used are static.  Since for the
readline DLL, they are not known until runtime, I
moved the non-static part of the initialization into
three functions.  The code now compiles.

NOTE: I still need to determine when to call these init
routines and insert the appropriate calls during module
initialization!

Problem 4: There were many errors aboue failed imp_rl_*
dependencies.  I hand-edited the Makefile to replace
the libreadline.a by libreadline.dll.a in the two places
it was called and now the DLL is found.

Problem 5: There are still several tty/termcap/curses
type routines that are not found in the link.  It looks
like the check I commented out in the Makefile.PL may
have been needed after all.  Very poorly documented!

Installing PDCurses from http://pdcurses.sourceforge.net
resolved the problems with the missing tputs() and
tgetstr() calls.  I had to manually add 

  C:\strawberry\c\bin\pdcurses.dll and
  C:\strawberry\c\lib\libreadline.dll.a 

to LDLOADLIBS and EXTRALIBS as before.  Apparently,
Makefile.PL is specific to unix and does not work
for DLLs since it is looking for .so and others.
The two remaining missing routines:

  _imp__rl_tty_unset_default_bindings
  _imp__rl_get_termcap

are not in readline-5.0 because in the win32 readline
gotten from http://gnuwin32.sourceforge.net/packages/readline.htm
the definitions of these two routines are ifdef'd out
for WIN32 platforms.  I don't know if these are needed
for proper functioning of the library as far as PDL
ReadLine uses go.  At any rate, I commented out the refs
to these two in Gnu.xs source.

Problem 6: After these fixes, the Term::ReadLine::Gnu library
compiled and built completely.  It does not run on the tests...
becuase I forgot to add the needed initialize code to
set up the str_tbl, int_tbl, and fn_tbl on startup.  With
luck there is an obvious place to put them for startup.
